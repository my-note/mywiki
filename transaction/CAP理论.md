![](http://placekitten.com/800/200)


# CAP理论




* C: Consistency, 一致性
* A: Availability, 可用性
* P: Partition, 分区容忍性

> 在所有的**分布式事物**场景中，不会同时具备 _CAP_ 三个特性，因为在具备了 P 的前提下，C 和 A 是不能共存的。
> 在不具备P的前期下（分布式），谈论分布式事物就是耍流氓。例如mysql单节点，本身就满足AC

## Consistency一致性

这里所说的一致性是实时一致性，并不是最终一致性。

是指写操作后的读操作可以读取到最新的数据状态，当数据分布在多个节点上，从任意节点读取到的数据都是最新的状态。

如何满足一致性？

加锁同步等待。等所有节点数据同步（状态统一）了，该操作才返回结束响应。
如果有节点数据同步失败了，整个操作响应失败。

一致性的特点：

1. 由于存在数据同步过程（加锁同步等待所有的节点数据同步完成），写操作的响应会有一定的延迟
2. 为了保证数据一致性，会对资源暂时锁定，待数据同步完成，释放锁定资源
3. 如果在这期间请求数据同步失败的节点，则会返回错误信息，一定不会返回旧数据。

## Availability可用性

数据分布存储的各个存储系统，在任何事物操作都可以得到响应结果，且不会出现响应超时或者响应错误.

不去锁定资源，保证资源随时可用，哪怕返回旧数据，也要保证数据资源的可用性。

可用性的特点：

1. 所有的请求都有响应，不会出现响应超时或者响应错误。

## Partition tolerance分区容错性

各个数据存储系统，为了保证高可用，分布式部署，数据要同步。一个节点挂点，保证数据依然正常可用。


## CAP 有哪些组合方式？

在生产中，对分布式事物处理时，要根据需求来确定满足CAP的哪两个方面。

1. AP

放弃一致性，追求分区容忍性和可用性。这是很多分布式系统设计的选中。

通常实现AP都会保证最终一致性，后面讲的BASE理论就是根据AP来扩展的。一些业务场景 比如：今日退款成功，明日账户到账，只要用户可以接受在一定时间内到账即可。

2. CP

放弃可用性，追求一致性和分区容错性，我们的zookeeper其实就是追求的强一致性。比如跨行转账，一次转账请求要等待双方银行系统都完成整个事物才算完成。

3. CA

放弃分区容错性（分布式），即不进行分区，不考虑由于网络不通或节点挂掉的问题，可以实现一致性和可用性，那么系统将不再是一个标准的分布式系统。

我们最常用的关系型数据库就满足CA.

    CAP是一个已近被证实的理论。一个分布式系统最多只能同时满足一致性（C）、可用性（A）和分区容错性（P）三项中的两项。
    对于多数大型互联网应用场景，节点多部署分散，而且集群规模越来越大，所以节点故障、网络故障是常态。
    而且要保证服务可用性达到n个9（99.99...%）,并要达到良好的响应性能来提升用户体验，因此一般会做出如下选择：
    保证P和A,舍弃强一致性，保证最终一致性




