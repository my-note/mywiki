# 哨兵监控架构的讲解

Redis Sentinel 是分布式系统中监控Redis主从服务器，并提供主服务器下线时自动故障转移功能的模式。其中4个特性为：

| 特性                                 | 详解                                                                    |
|--------------------------------------|-------------------------------------------------------------------------|
| 监控（Monitoring）                   | 监控主从节点的健康状况                                                  |
| 提醒（Notification）                 | 提供客户端程序和其他节点                                                |
| 自动故障转移（Automatic failover）   | 主节点挂了，从节点转变为主节点继续提供服务                              |
| 配置提供者（Configuration provider） | 客户端连接Sentinel, Sentinel连接Redis集群，由Sentinel告诉客户端主从配置 |

## Sentinel 的分布式特性

Redis Sentinel 是一个分布式系统，可以在一个架构中运行多个Sentinel进程，优势 如下：

* 降低了误报的可能性
* 降低了对客户端的影响
* 任意Sentinel都可以对外提供服务

## 部署 Sentinel 需要了解

* 端口 26379
    - 默认端口号
* 至少3个Sentinel实例
    - Sentinel分布式，3个保持健壮性（少数服从多数仲裁）
* 运行 Sentinel 必须指定配置文件
    - 系统使用文件保存主从状态的
    - Sentinel从文件中读取主从状态，也将变动后的新的主从状态写回到配置文件中
* 独立的虚拟机或物理机中运行
    - 推荐
* 可配置Sentinel允许丢失有限的写入
    - 可配置,因为主从切换需要时间，会丢失数据
* 客户端要支持Sentinel
    - 客户端直接连接 Sentinel 服务
* 经常在测试环境中测试
* 在docker、端口映射或网络地址转换的环境中配置要格外小心

## Sentinel 优缺点

* **优点**
    * 哨兵模式是基于主从模式的，所有主从的优点，哨兵都有
    * 主从可以自动切换，系统更简装，可用性更高
    * Sentinel会不断的检查你的master和replica是否运行正常。当被监控的某个redis服务器出现问题时，Sentinel可以通过api向管理员或者其他应用程序发送通知
* **缺点**
    * 主从切换需要时间，会丢失数据
    * 还是没有解决主节点的写压力（升级cluster模式）
    * 主节点的写能力、存储能力受到单机的限制
    * 动态扩容困难复杂，对于集群，容量达到上限时在线扩容会变成更复杂



































